define((function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=43)}({0:function(t,e,i){"use strict";function s(t,e,i,s,n,o,a,r){var c=typeof(t=t||{}).default;"object"!==c&&"function"!==c||(t=t.default);var l,u="function"==typeof t?t.options:t;if(e&&(u.render=e,u.staticRenderFns=i,u._compiled=!0),s&&(u.functional=!0),o&&(u._scopeId=o),a?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),n&&n.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},u._ssrRegister=l):n&&(l=r?function(){n.call(this,this.$root.$options.shadowRoot)}:n),l)if(u.functional){u._injectStyles=l;var p=u.render;u.render=function(t,e){return l.call(e),p(t,e)}}else{var d=u.beforeCreate;u.beforeCreate=d?[].concat(d,l):[l]}return{exports:t,options:u}}i.d(e,"a",(function(){return s}))},43:function(t,e,i){"use strict";function s(){return n("activity-composer-action").filter((function(t){return function(t){if(t.hasOwnProperty("enabled")){if("boolean"==typeof t.enabled)return t.enabled;if(o(t.enabled))return t.enabled.call()}return!0}(t)}))}function n(t){return extensionRegistry.loadExtensions("ActivityComposer",t)}function o(t){return t&&"[object Function]"==={}.toString.call(t)}i.r(e);var a={directives:{DynamicEvents:{bind:function(t,e,i){var s=e.value;s&&s.forEach((function(t){i.componentInstance.$on(t.event,(function(e){var s=e||t.listenerParam;i.context[t.listener](s)}))}))},unbind:function(t,e,i){i.componentInstance.$off()}}},props:{activityBody:{type:String,default:""},activityId:{type:String,default:""},activityParams:{type:Object,default:null},composerAction:{type:String,default:"post"},standalone:{type:Boolean,default:!1}},data:function(){return{MESSAGE_MAX_LENGTH:1300,MESSAGE_TIMEOUT:5e3,postTarget:"",showMessageComposer:!1,message:"",loading:!1,showErrorMessage:!1,activityBodyEdited:!1,activityComposerActions:[],activityComposerHintAction:null,attachments:[],percent:100,actionsData:[],actionsEvents:[],templateParams:{},ckEditorId:"activityContent",link:""+this.$t("activity.composer.link")}},computed:{messageLength:function(){return this.message&&this.message.length&&this.$utils.htmlToText(this.message).length||0},postDisabled:function(){return!this.attachments.length&&!this.messageLength||this.messageLength>this.MESSAGE_MAX_LENGTH||this.uploading||this.loading||!!this.activityId&&!this.activityBodyEdited},activityType:function(){return this.attachments.length?"files:spaces":""},attachmentsProgress:function(){return 0!==this.attachments.length?this.uploadingProgress/this.attachments.length:0},uploading:function(){return this.attachments.length*this.percent!==this.uploadingProgress},displayHintMessage:function(){return this.activityComposerHintAction&&this.activityComposerHintAction.enabled&&this.messageLength>this.MESSAGE_MAX_LENGTH},uploadingProgress:function(){var t=this;return this.attachments.map((function(e){return void 0!==e.uploadProgress?e.uploadProgress:t.percent})).reduce((function(t,e){return t+e}),0)}},watch:{showErrorMessage:function(t){var e=this;t&&setTimeout((function(){return e.showErrorMessage=!1}),this.MESSAGE_TIMEOUT)},message:function(t,e){this.activityId&&!this.activityBodyEdited&&(this.activityBodyEdited=this.$utils.htmlToText(t)!==this.$utils.htmlToText(e))}},created:function(){document.addEventListener("activity-composer-edit-activity",this.editActivity),document.addEventListener("activity-composer-extension-updated",this.refreshExtensions),this.templateParams=this.activityParams||{},this.postTarget=eXo.env.portal.spaceDisplayName||"",eXo.env.portal.spaceDisplayName||(this.link=this.$t("activity.composer.post"))},mounted:function(){var t=this;this.$nextTick().then((function(){return t.refreshExtensions()})).then((function(){t.message=t.activityBody,t.resetEdited(),t.activityId&&t.editActivity()}))},methods:{refreshExtensions:function(){var t,e=this,i=[];return this.activityComposerActions=s(),this.activityComposerHintAction=(t=n("activity-composer-hint-action"))&&t.length&&t[0]||null,this.activityComposerActions.forEach((function(t){t.component&&(e.actionsData[t.key]=t.component.model.value,e.actionsEvents[t.key]=t.component.events),t.resourceBundle&&i.push("/portal/rest/i18n/bundle/"+t.resourceBundle+"-"+eXo.env.portal.language+".json")})),exoi18n.loadLanguageAsync(eXo.env.portal.language,i).then((function(t){t&&new Vue({i18n:t})}))},editActivity:function(t){var e=this;(t=t&&t.detail)&&(this.resetComposer(),this.message=t.activityBody,this.activityId=t.activityId,this.composerAction=t.composerAction,this.templateParams=t.activityParams||{},this.resetEdited()),this.showMessageComposer=!0,this.$nextTick((function(){return e.$refs[e.ckEditorId].setFocus()}))},openMessageComposer:function(){var t=this;this.activityId&&(this.activityId=null,this.resetComposer()),this.composerAction="post",this.message="",this.resetEdited(),this.templateParams={},this.showMessageComposer=!0,this.$nextTick((function(){return t.$refs[t.ckEditorId].setFocus()}))},getLabel:function(t){var e=this.$t(t);return e||t},postMessage:function(){var t=this,e=this.$refs[this.ckEditorId].getMessage();if("update"===this.composerAction){var i=this.activityType;this.templateParams&&this.templateParams.link&&!this.activityType&&(i="LINK_ACTIVITY"),this.loading=!0,this.$activityService.updateActivity(this.activityId,e,i,this.attachments,this.templateParams).then((function(){document.dispatchEvent(new CustomEvent("activity-updated",{detail:t.activityId})),t.closeMessageComposer()})).then((function(){return t.refreshCurrentActivity()})).then((function(){t.resetComposer()})).catch((function(e){console.error("Error when updating the activity: "+e),t.showErrorMessage=!0})).finally((function(){return t.loading=!1}))}else{var s=this.activityType;this.templateParams&&this.templateParams.link&&!this.activityType&&(s="LINK_ACTIVITY"),this.loading=!0,this.$activityService.createActivity(e,s,this.attachments,eXo.env.portal.spaceId,this.templateParams).then((function(){document.dispatchEvent(new CustomEvent("activity-created",{detail:t.activityId})),t.refreshActivityStream()})).then((function(){return t.closeMessageComposer()})).then((function(){t.resetComposer()})).catch((function(e){console.error("Error when posting message: "+e),t.showErrorMessage=!0})).finally((function(){return t.loading=!1}))}},resetEdited:function(){var t=this;this.$nextTick().then((function(){return t.activityBodyEdited=!1}))},resetComposer:function(){var t=this;this.activityComposerActions.forEach((function(e){e.component&&(e.component.model.value=e.component.model.default.slice(),t.actionsData[e.key].value=e.component.model.value)})),this.attachments=[],this.showErrorMessage=!1,this.message="",this.resetEdited()},refreshActivityStream:function(){var t=document.querySelector(".activityStreamStatus #RefreshButton");t&&t.click()},closeMessageComposer:function(){this.showMessageComposer=!1,this.$refs[this.ckEditorId].unload()},executeAction:function(t,e){!function(t,e,i){t.hasOwnProperty("onExecute")&&o(t.onExecute)&&(e?t.onExecute(e[0]):t.onExecute(i))}(t,this.$refs[t.key],e)},updateAttachments:function(t){this.attachments=t},refreshCurrentActivity:function(){var t=document.querySelector("#activityContainer"+this.activityId+" #RefreshActivity"+this.activityId);t&&t.click()},escapeHTML:function(t){var e=document.createElement("textarea");return e.innerHTML=t,e.value.replace(/>\s+</g,"><").trim()}}},r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"activityComposer pa-0",attrs:{id:"activityComposer"}},[t.standalone?t._e():i("div",{staticClass:"openLink mb-4"},[i("a",{on:{click:function(e){return t.openMessageComposer()}}},[i("i",{staticClass:"uiIconEdit"}),t._v("\n      "+t._s(t.link.replace("{0}",t.postTarget))+"\n    ")])]),t._v(" "),i("v-app",{staticClass:"activityComposerApp VuetifyApp",attrs:{id:"activityComposerApp"}},[i("div",{staticClass:"drawer",class:[t.showMessageComposer?"open":"",t.activityId?"editActivity editActivityDrawer"+t.activityId:""]},[i("div",{staticClass:"header"},[i("img",{attrs:{src:"/eXoSkin/skin/images/system/composer/composer.png",loading:"lazy"}}),t._v(" "),i("span",[t._v(" "+t._s(t.$t("activity.composer.title")))]),t._v(" "),i("a",{staticClass:"closebtn",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.closeMessageComposer()}}},[t._v("Ã—")])]),t._v(" "),i("div",{staticClass:"content"},[t.showMessageComposer?i("exo-activity-rich-editor",{ref:t.ckEditorId,attrs:{"ck-editor-type":t.ckEditorId,"max-length":t.MESSAGE_MAX_LENGTH,"template-params":t.templateParams,placeholder:t.$t("activity.composer.placeholder").replace("{0}",t.MESSAGE_MAX_LENGTH),autofocus:""},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}}):t._e(),t._v(" "),i("div",{staticClass:"composerButtons"},[t.displayHintMessage?i("div",{staticClass:"action"},[i("i",{staticClass:"fas fa-pencil-alt fa-sm colorIcon",on:{click:function(e){return t.activityComposerHintAction.onExecute(t.attachments)}}}),t._v(" "),i("a",{staticClass:"message",attrs:{href:"javascript:void(0)"},on:{click:function(e){return t.activityComposerHintAction.onExecute(t.attachments)}}},[t._v(t._s(t.getLabel(t.activityComposerHintAction.labelKey))+" ")])]):i("div",{staticClass:"emptyMessage"}),t._v(" "),i("div",[i("v-btn",{staticClass:"primary btn no-box-shadow",attrs:{disabled:t.postDisabled,loading:t.loading,type:"button"},on:{click:function(e){return t.postMessage()}}},[t._v("\n              "+t._s(t.$t("activity.composer."+t.composerAction))+"\n            ")])],1)]),t._v(" "),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.showErrorMessage,expression:"showErrorMessage"}],staticClass:"alert alert-error"},[i("i",{staticClass:"uiIconError"}),t._v(t._s(t.$t("activity.composer.post.error"))+"\n          ")])]),t._v(" "),i("div",{staticClass:"VuetifyApp"},[i("v-app",[t.attachments.length?i("div",{staticClass:"attachmentsList"},[i("v-progress-circular",{class:t.uploading?"uploading":"",attrs:{indeterminate:!1,value:t.attachmentsProgress}},[i("i",{staticClass:"uiIconAttach"})]),t._v(" "),i("div",{staticClass:"attachedFiles"},[t._v(t._s(t.$t("attachments.drawer.title"))+" ("+t._s(t.attachments.length)+")")])],1):t._e()])],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.activityId&&t.showMessageComposer,expression:"activityId ? false : showMessageComposer"}],staticClass:"composerActions"},t._l(t.activityComposerActions,(function(e){return i("div",{key:e.key,class:e.appClass+"Action"},[i("div",{staticClass:"actionItem",on:{click:function(i){return t.executeAction(e,t.attachments)}}},[i("div",{staticClass:"actionItemIcon"},[i("div",{class:e.iconClass})]),t._v(" "),i("div",{staticClass:"actionItemDescription"},[i("div",{staticClass:"actionLabel"},[t._v(t._s(t.getLabel(e.labelKey)))]),t._v(" "),i("div",{staticClass:"actionDescription"},[i("p",[t._v(t._s(t.getLabel(e.description)))])])])]),t._v(" "),e.component?i(e.component.name,t._b({directives:[{name:"dynamic-events",rawName:"v-dynamic-events",value:t.actionsEvents[e.key],expression:"actionsEvents[action.key]"}],ref:e.key,refInFor:!0,tag:"component",model:{value:t.actionsData[e.key].value,callback:function(i){t.$set(t.actionsData[e.key],"value",i)},expression:"actionsData[action.key].value"}},"component",e.component.props,!1)):t._e()],1)})),0)],1)])]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.showMessageComposer,expression:"showMessageComposer"}],staticClass:"drawer-backdrop",class:"drawer-backdrop-activity"+t.activityId,on:{click:function(e){return t.closeMessageComposer()}}})],1)};r._withStripped=!0;var c=i(0),l=Object(c.a)(a,r,[],!1,null,null,null);l.options.__file="src/main/webapp/vue-apps/activity-composer-app/components/ExoActivityComposer.vue";var u=l.exports;if(Vue.component("exo-activity-composer",u),extensionRegistry){var p=extensionRegistry.loadComponents("ActivityComposer");p&&p.length>0&&p.forEach((function(t){Vue.component(t.componentName,t.componentOptions)}))}}})}));