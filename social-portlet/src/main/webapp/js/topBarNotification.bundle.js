define((function(){return function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=41)}({0:function(t,e,i){"use strict";function n(t,e,i,n,o,a,r,s){var c=typeof(t=t||{}).default;"object"!==c&&"function"!==c||(t=t.default);var l,f="function"==typeof t?t.options:t;if(e&&(f.render=e,f.staticRenderFns=i,f._compiled=!0),n&&(f.functional=!0),a&&(f._scopeId=a),r?(l=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),o&&o.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(r)},f._ssrRegister=l):o&&(l=s?function(){o.call(this,this.$root.$options.shadowRoot)}:o),l)if(f.functional){f._injectStyles=l;var d=f.render;f.render=function(t,e){return l.call(e),d(t,e)}}else{var u=f.beforeCreate;f.beforeCreate=u?[].concat(u,l):[l]}return{exports:t,options:f}}i.d(e,"a",(function(){return n}))},41:function(t,e,i){"use strict";i.r(e),i.d(e,"updateBadge",(function(){return v})),i.d(e,"init",(function(){return h}));var n={};i.r(n),i.d(n,"getNotifications",(function(){return f})),i.d(n,"updateNotification",(function(){return d})),i.d(n,"initCometd",(function(){return u}));var o={data:function(){return{loading:!1,drawerNotification:!1,notifications:[],badge:0,notificationsSize:0,settingsLink:eXo.env.portal.context+"/"+eXo.env.portal.portalName+"/settings",allNotificationsLink:eXo.env.portal.context+"/"+eXo.env.portal.portalName+"/allNotifications"}},watch:{badge:function(){return this.badge},loading:function(){!this.loading&&this.$refs.drawerNotificationDrawer&&this.$refs.drawerNotificationDrawer.endLoading()}},created:function(){document.addEventListener("cometdNotifEvent",this.notificationUpdated),this.getNotifications()},mounted:function(){this.$refs.drawerNotificationDrawer&&(this.loading?this.$refs.drawerNotificationDrawer.startLoading():this.$refs.drawerNotificationDrawer.endLoading()),this.openDrawer(),this.$root.$applicationLoaded()},methods:{getNotifications:function(){var t=this;return this.loading=!0,this.$notificationService.getNotifications().then((function(e){return t.notifications=e.notifications,t.badge=e.badge,t.notificationsSize=t.notifications.length,t.$nextTick()})).finally((function(){return t.loading=!1}))},markAllAsRead:function(){var t=this;return this.$notificationService.updateNotification(null,"markAllAsRead").then((function(){$(".notifDrawerItems").find("li").each((function(){$(this).hasClass("unread")&&$(this).removeClass("unread").addClass("read")}))})).finally((function(){return t.$root.$emit("application-loaded")}))},openDrawer:function(){var t=this;return this.$refs.drawerNotificationDrawer.open(),this.$notificationService.updateNotification(null,"resetNew").then((function(){return t.badge=0}))},closeDrawer:function(){var t=this;this.$refs.drawerNotificationDrawer.close(),this.$nextTick().then((function(){return t.$root.$emit("application-loaded")}))},navigateTo:function(t){location.href=eXo.env.portal.context+"/"+eXo.env.portal.portalName+"/"+t},applyActions:function(t){$("#"+t).find("li").each((function(){var t=$(this).find(".contentSmall:first").data("link");void 0===t&&(t=$(this).find(".media").children("a").attr("href")),t.includes("/portal/g/")||t.includes("/portal/rest/")?t.replace(/\/portal\//,eXo.env.portal.context+"/"):t.replace(/\/portal\/([a-zA-Z0-9_-]+)\//,eXo.env.portal.context+"/"+eXo.env.portal.portalName+"/");var e=t.split(eXo.env.portal.context+"/"),i=$(this).data("id").toString();if(null!=e&&e.length>1)if(e[0].includes("/view_full_activity/")){var n=e[0].split("/view_full_activity/")[1];$(this).parent().attr("href",eXo.env.portal.context+"/"+eXo.env.portal.portalName+"/activity?id="+n)}else $(this).parent().attr("href",eXo.env.portal.context+"/"+e[1]);else $(this).parent().attr("href",t.replace(/^\/rest\//,eXo.env.portal.context+"/rest/"));$(this).on("click",(function(){$(this).hasClass("unread")&&$(this).removeClass("unread").addClass("read"),Vue.prototype.$notificationService.updateNotification(i,"markAsRead")})),$(this).find(".remove-item").off("click").on("click",(function(t){t.preventDefault(),t.stopPropagation(),Vue.prototype.$notificationService.updateNotification(i,"hide"),$(this).parents("li:first").slideUp(300)})),$(this).find(".action-item").off("click").on("click",(function(t){t.stopPropagation();var e=$(this).data("rest");e.indexOf("?")>=0?e+="&":e+="?",(e+="portal:csrf="+eXo.env.portal.csrfToken)&&e.length>0&&$.ajax(e).done((function(){$(document).trigger("exo-invitation-updated")})),Vue.prototype.$notificationService.updateNotification(i,"hide"),$(this).parents("li:first").slideUp(600)})),$(this).find(".cancel-item").off("click").on("click",(function(t){t.stopPropagation();var e=$(this).data("rest");e.indexOf("?")>=0?e+="&":e+="?",(e+="portal:csrf="+eXo.env.portal.csrfToken)&&e.length>0&&$.ajax(e).done((function(){$(document).trigger("exo-invitation-updated")})),Vue.prototype.$notificationService.updateNotification(i,"hide"),$(this).parents("li:first").slideUp(600)}))}))},notificationUpdated:function(t){t&&t.detail&&(this.badge=t.detail.data.numberOnBadge,this.getNotifications())}}},a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-app",{attrs:{id:"NotificationPopoverPortlet"}},[i("v-flex",[i("v-layout",[i("v-btn",{staticClass:"text-xs-center",attrs:{icon:""},on:{click:function(e){return t.openDrawer()}}},[i("v-badge",{attrs:{value:t.badge>0,content:t.badge,flat:"",color:"var(--allPagesBadgePrimaryColor, #ff5335)",overlap:""}},[i("v-icon",{staticClass:"grey-color",attrs:{size:"21"}},[t._v("mdi-bell")])],1)],1),t._v(" "),i("exo-drawer",{ref:"drawerNotificationDrawer",staticClass:"notifDrawer",attrs:{"body-classes":"hide-scroll",right:""}},[i("template",{slot:"title"},[t._v("\n          "+t._s(t.$t("UIIntranetNotificationsPortlet.title.notifications"))+"\n        ")]),t._v(" "),i("template",{slot:"titleIcons"},[i("v-btn",{attrs:{title:t.$t("UIIntranetNotificationsPortlet.title.NotificationsSetting"),href:t.settingsLink,icon:""}},[i("v-icon",{staticClass:"uiSettingsIcon notifDrawerSettings"})],1)],1),t._v(" "),t.notificationsSize?i("template",{slot:"content"},[i("div",{staticClass:"notifDrawerItems"},t._l(t.notifications,(function(e,n){return i("a",{directives:[{name:"sanitized-html",rawName:"v-sanitized-html",value:e.notification,expression:"notif.notification"}],key:n,staticClass:"notifDrawerItem",attrs:{id:"notifItem-"+n},on:{mouseenter:function(e){return t.applyActions("notifItem-"+n)}}})})),0)]):t.loading?t._e():i("template",{slot:"content"},[i("div",{staticClass:"noNoticationWrapper"},[i("div",{staticClass:"noNotificationsContent"},[i("i",{staticClass:"uiNoNotifIcon"}),t._v(" "),i("p",[t._v(t._s(t.$t("UIIntranetNotificationsPortlet.label.NoNotifications")))])])])]),t._v(" "),t.notificationsSize?i("template",{slot:"footer"},[i("v-row",{staticClass:"notifFooterActions mx-0"},[i("v-card",{staticClass:"d-flex flex justify-end mx-2",attrs:{flat:"",tile:""}},[i("v-btn",{staticClass:"text-uppercase caption markAllAsRead",attrs:{text:"",small:"",color:"primary"},on:{click:function(e){return t.markAllAsRead()}}},[t._v("\n                "+t._s(t.$t("UIIntranetNotificationsPortlet.label.MarkAllAsRead"))+"\n              ")]),t._v(" "),i("v-btn",{staticClass:"text-uppercase caption primary--text seeAllNotif",attrs:{href:t.allNotificationsLink,outlined:"",small:""}},[t._v("\n                "+t._s(t.$t("UIIntranetNotificationsPortlet.label.seeAll"))+"\n              ")])],1)],1)],1):t._e()],2)],1)],1)],1)};a._withStripped=!0;var r=i(0),s=Object(r.a)(o,a,[],!1,null,null,null);s.options.__file="src/main/webapp/vue-apps/notification-top-bar/components/ExoTopBarNotification.vue";var c={"exo-top-bar-notification":s.exports};for(var l in c)Vue.component(l,c[l]);function f(){return fetch("/portal/rest/notifications/webNotifications",{method:"GET",credentials:"include"}).then((function(t){if(t&&t.ok)return t.json();throw new Error("Error when getting notification list")}))}function d(t,e){return fetch("/portal/rest/notifications/webNotifications/"+t,{headers:{"Content-Type":"text/plain",credentials:"include"},method:"PATCH",body:e})}function u(){var t=window.location;cCometd.configure({url:t.protocol+"//"+t.hostname+(t.port?":":"")+(t.port||"")+"/cometd/cometd",exoId:eXo.env.portal.userName,exoToken:eXo.env.portal.cometdToken}),cCometd.subscribe("/eXo/Application/web/NotificationMessage",null,(function(t){var e=JSON.parse(t.data);document.dispatchEvent(new CustomEvent("cometdNotifEvent",{detail:{data:e}}))}))}if(extensionRegistry){var p=extensionRegistry.loadComponents("TopBarNotification");p&&p.length>0&&p.forEach((function(t){Vue.component(t.componentName,t.componentOptions)}))}function v(t){if(t&&t.detail){var e=t.detail.data.numberOnBadge,i=document.querySelector("#NotificationPopoverPortlet .v-badge__wrapper");0===e?i.classList.add("hidden"):i.classList.remove("hidden"),i.querySelector("span").innerText=e}}function h(){document.removeEventListener("cometdNotifEvent",v);var t="NotificationPopoverPortlet",e=eXo.env.portal.language,i=Vue.prototype.$spacesConstants.PORTAL+"/"+Vue.prototype.$spacesConstants.PORTAL_REST+"/i18n/bundle/locale.portlet.Portlets-"+e+".json";exoi18n.loadLanguageAsync(e,i).then((function(){Vue.createApp({template:'<exo-top-bar-notification id="'+t+'"></exo-top-bar-notification>',vuetify:Vue.prototype.vuetifyOptions,i18n:exoi18n.i18n},"#"+t,"Topbar Notifications")}))}window.Object.defineProperty(Vue.prototype,"$notificationService",{value:n}),u(),document.addEventListener("cometdNotifEvent",v)}})}));