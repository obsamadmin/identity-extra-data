define((function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=20)}({0:function(e,t,n){"use strict";function i(e,t,n,i,r,o,a,s){var c=typeof(e=e||{}).default;"object"!==c&&"function"!==c||(e=e.default);var l,u="function"==typeof e?e.options:e;if(t&&(u.render=t,u.staticRenderFns=n,u._compiled=!0),i&&(u.functional=!0),o&&(u._scopeId=o),a?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),r&&r.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(a)},u._ssrRegister=l):r&&(l=s?function(){r.call(this,this.$root.$options.shadowRoot)}:r),l)if(u.functional){u._injectStyles=l;var d=u.render;u.render=function(e,t){return l.call(t),d(e,t)}}else{var p=u.beforeCreate;u.beforeCreate=p?[].concat(p,l):[l]}return{exports:e,options:u}}n.d(t,"a",(function(){return i}))},20:function(e,t,n){"use strict";n.r(t),n.d(t,"init",(function(){return O}));var i={props:{maxUploadSize:{type:Number,default:function(){return 2}}},data:function(){return{user:null,owner:eXo.env.portal.profileOwner===eXo.env.portal.userName,errorMessage:null}},computed:{mobile:function(){return"xs"===this.$vuetify.breakpoint.name},maxUploadSizeInBytes:function(){return 1024*this.maxUploadSize*1024}},mounted:function(){var e=this;this.refresh(),document.addEventListener("userModified",(function(t){t&&t.detail&&t.detail!==e.user&&(Object.assign(e.user,t.detail),e.$nextTick().then((function(){return e.$root.$emit("application-loaded")})))}))},methods:{avatarUpdated:function(){var e=this;this.refresh().then((function(){document.dispatchEvent(new CustomEvent("userModified",{detail:e.user}))}))},refresh:function(){var e=this;return this.$userService.getUser(eXo.env.portal.profileOwner,"relationshipStatus").then((function(t){return e.user=t,e.$nextTick()})).catch((function(e){console.warn("Error while retrieving user details",e)})).finally((function(){return e.$nextTick().then((function(){return e.$root.$applicationLoaded()}))}))},handleError:function(e){e&&(String(e).indexOf(this.$uploadService.avatarExcceedsLimitError)>=0?this.errorMessage=this.$t("profileHeader.label.avatarExcceededAllowedSize",{0:this.maxUploadSize}):String(e).indexOf(this.$uploadService.bannerExcceedsLimitError)>=0?this.errorMessage=this.$t("profileHeader.label.bannerExcceededAllowedSize",{0:this.maxUploadSize}):this.errorMessage=String(e),this.$refs.errorUploadDialog.open())}}},r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",{class:e.owner?"profileHeaderOwner":"profileHeaderOther"},[n("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var i=t.hover;return n("v-img",{staticClass:"profileBannerImg d-flex",attrs:{"lazy-src":e.user&&e.user.banner,src:e.user&&e.user.banner,transition:"none","min-height":"240px",height:"240px","max-height":"240px",eager:""}},[n("v-flex",{attrs:{"fill-height":""}},[n("v-layout",[n("v-flex",{staticClass:"d-flex profileHeaderTitle"},[n("exo-confirm-dialog",{ref:"errorUploadDialog",attrs:{message:e.errorMessage,title:e.$t("profileHeader.title.errorUploadingImage"),"ok-label":e.$t("profileHeader.label.ok")}}),e._v(" "),n("v-hover",{scopedSlots:e._u([{key:"default",fn:function(t){var r=t.profileHover;return n("profile-header-avatar",{attrs:{user:e.user,"max-upload-size":e.maxUploadSizeInBytes,owner:e.owner,hover:i||r,save:""},on:{refresh:e.avatarUpdated,error:e.handleError}})}}],null,!0)}),e._v(" "),n("div",{staticClass:"profileHeader"},[n("div",{staticClass:"profileHeaderText align-start d-flex flex-grow-0"},[n("profile-header-text",{staticClass:"ma-auto pb-0",class:e.skeleton?"skeleton-text":"",attrs:{user:e.user,skeleton:e.skeleton}})],1),e._v(" "),n("div",{staticClass:"flex-grow-1"}),e._v(" "),e.skeleton?e._e():n("div",{staticClass:"d-flex flex-grow-0 justify-end pe-2"},[e.owner?n("profile-header-banner-button",{attrs:{user:e.user,"max-upload-size":e.maxUploadSizeInBytes,owner:e.owner,hover:i},on:{refresh:e.refresh,error:e.handleError}}):n("profile-header-actions",{attrs:{user:e.user,owner:e.owner,hover:i},on:{refresh:e.refresh}})],1)])],1)],1)],1)],1)}}])})],1)};r._withStripped=!0;var o=n(0),a=Object(o.a)(i,r,[],!1,null,null,null);a.options.__file="src/main/webapp/vue-apps/profile-header/components/ProfileHeader.vue";var s=a.exports,c={props:{user:{type:Object,default:function(){return null}}},computed:{external:function(){if(this.user&&"true"===this.user.external){var e=this.$t("profileHeader.label.external");return" ("+e+") "}return""},disabled:function(){if(this.user&&!this.user.enabled){var e=this.$t("profileHeader.label.disabled");return" ("+e+") "}return""}}},l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-flex",[n("v-card-title",{staticClass:"headline white--text"},[e._v("\n    "+e._s(e.user&&e.user.fullname)+e._s(e.external)+e._s(e.disabled)+"\n  ")]),e._v(" "),n("v-card-subtitle",{staticClass:"subtitle white--text",attrs:{dark:""}},[e._v("\n    "+e._s(e.user&&e.user.position||"")+"\n  ")])],1)};l._withStripped=!0;var u=Object(o.a)(c,l,[],!1,null,null,null);u.options.__file="src/main/webapp/vue-apps/profile-header/components/ProfileHeaderText.vue";var d=u.exports;var p,f=(p="action-component",extensionRegistry.loadExtensions("profile-header",p)),v={props:{user:{type:Object,default:function(){return null}},owner:{type:Boolean,default:function(){return!0}},hover:{type:Boolean,default:function(){return!1}}},data:function(){return{profileActionExtensions:[],mobileAcceptRefuseConnectionDialog:!1,sendingAction:!1,sendingSecondAction:!1,displaySecondButton:!1,waitTimeUntilCloseMenu:200,profileHeaderActionComponents:f,isMounted:null,resolveMounting:null}},computed:{isMobile:function(){return this.$vuetify&&this.$vuetify.breakpoint&&"xs"===this.$vuetify.breakpoint.name},enabledProfileHeaderActionComponents:function(){return this.profileHeaderActionComponents&&this.profileHeaderActionComponents.filter((function(e){return e.enabled}))||[]},relationshipStatus:function(){return this.user&&this.user.relationshipStatus},connected:function(){return"CONFIRMED"===this.relationshipStatus},disconnected:function(){return!this.relationshipStatus||"IGNORED"===this.relationshipStatus},invited:function(){return"INCOMING"===this.relationshipStatus},requested:function(){return"OUTGOING"===this.relationshipStatus},enabledProfileActionExtensions:function(){var e=this;return this.profileActionExtensions&&this.user?this.profileActionExtensions.slice().filter((function(t){return t.enabled(e.user)})):[]}},created:function(){var e=this;document.addEventListener("profile-extension-updated",this.refreshExtensions),document.dispatchEvent(new CustomEvent("profile-extension-init")),this.refreshExtensions(),$(document).on("mousedown",(function(){e.displaySecondButton&&window.setTimeout((function(){e.displaySecondButton=!1}),e.waitTimeUntilCloseMenu)}));var t=this;this.isMounted=new Promise((function(e){t.resolveMounting=e}))},mounted:function(){this.resolveMounting()},methods:{refreshExtensions:function(){this.profileActionExtensions=extensionRegistry.loadExtensions("profile-extension","action")||[]},openSecondButton:function(e){e?this.mobileAcceptRefuseConnectionDialog=!0:this.displaySecondButton=!this.displaySecondButton},connect:function(){var e=this;this.sendingAction=!0,this.$userService.connect(this.user.username).then((function(){return e.$emit("refresh")})).catch((function(e){console.error("Error processing action",e)})).finally((function(){e.sendingAction=!1}))},acceptToConnect:function(){var e=this;this.sendingAction=!0,this.$userService.confirm(this.user.username).then((function(){return e.$emit("refresh")})).catch((function(e){console.error("Error processing action",e)})).finally((function(){e.sendingAction=!1}))},refuseToConnect:function(){var e=this;this.sendingSecondAction=!0,this.$userService.deleteRelationship(this.user.username).then((function(){return e.$emit("refresh")})).catch((function(e){console.error("Error processing action",e)})).finally((function(){e.sendingSecondAction=!1}))},cancelRequest:function(){var e=this;this.sendingAction=!0,this.$userService.deleteRelationship(this.user.username).then((function(){return e.$emit("refresh")})).catch((function(e){console.error("Error processing action",e)})).finally((function(){e.sendingAction=!1}))},initTitleActionComponent:function(e){var t=this,n=this;e.init&&!e.isStartedInit&&e.enabled&&this.user&&(e.isStartedInit=!0,this.isMounted.then((function(){var i=t.$refs[e.key];i&&i.length>0?(i=i[0],e.init(i,n.user.username)):console.error("Error initialization of the "+e.key+" action component: empty container")})))}}},h=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"d-flex mt-auto justify-end flex-wrap",class:e.owner?"profileHeaderOwnerActions":"profileHeaderOtherActions",attrs:{id:"profileHeaderActions"}},[!e.owner||e.skeleton?[e.skeleton?e._e():e._l(e.enabledProfileActionExtensions,(function(t,i){return n("v-btn",{key:i,staticClass:"btn ma-2 mb-0",on:{click:function(n){return t.click(e.user)}}},[n("i",{staticClass:"uiIcon",class:t.icon?t.icon:"hidden"}),e._v(" "),n("span",{staticClass:"buttonText"},[e._v("\n          "+e._s(t.title)+"\n        ")])])})),e._v(" "),e.invited?n("div",{staticClass:"invitationButtons d-inline"},[n("v-dialog",{attrs:{width:"200","max-width":"100vw"},model:{value:e.mobileAcceptRefuseConnectionDialog,callback:function(t){e.mobileAcceptRefuseConnectionDialog=t},expression:"mobileAcceptRefuseConnectionDialog"}},[n("v-card",{staticClass:"pa-0"},[n("v-btn",{staticClass:"white no-border-radius",attrs:{disabled:e.loading,loading:e.loading,block:""},on:{click:e.acceptToConnect}},[e._v("\n            "+e._s(e.$t("profileHeader.button.acceptToConnect"))+"\n          ")]),e._v(" "),n("v-btn",{staticClass:"white no-border-radius",attrs:{disabled:e.loading,loading:e.loading,block:""},on:{click:e.refuseToConnect}},[e._v("\n            "+e._s(e.$t("profileHeader.button.refuseToConnect"))+"\n          ")])],1)],1),e._v(" "),n("div",{staticClass:"acceptToConnectButtonParent"},[n("v-btn",{staticClass:"btn btn-primary mx-auto acceptToConnectButton",attrs:{loading:e.sendingAction,disabled:e.sendingAction},on:{click:e.acceptToConnect}},[n("i",{staticClass:"uiIconSocConnectUser"}),e._v(" "),n("span",{staticClass:"buttonText"},[e._v("\n            "+e._s(e.$t("profileHeader.button.acceptToConnect"))+"\n          ")])]),e._v(" "),n("v-btn",{staticClass:"btn btn-primary peopleButtonMenu dropdownButton",on:{click:e.openSecondButton}},[n("v-icon",[e._v("mdi-menu-down")])],1),e._v(" "),n("v-btn",{staticClass:"btn btn-primary peopleButtonMenu dialogButton",on:{click:function(t){return e.openSecondButton(!0)}}},[n("v-icon",[e._v("mdi-close")])],1)],1),e._v(" "),n("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.displaySecondButton,expression:"displaySecondButton"}],staticClass:"btn mx-auto refuseToConnectButton",attrs:{loading:e.sendingSecondAction,disabled:e.sendingSecondAction},on:{click:e.refuseToConnect}},[n("i",{staticClass:"uiIconSocCancelConnectUser"}),e._v(" "),n("span",{staticClass:"buttonText"},[e._v("\n          "+e._s(e.$t("profileHeader.button.refuseToConnect"))+"\n        ")])])],1):e.requested?n("v-btn",{staticClass:"btn btn-primary mx-auto cancelRequestButton",attrs:{loading:e.sendingAction,disabled:e.sendingAction},on:{click:e.cancelRequest}},[n("i",{staticClass:"uiIconSocCancelConnectUser"}),e._v(" "),n("span",{staticClass:"buttonText"},[e._v("\n        "+e._s(e.$t("profileHeader.button.cancelRequest"))+"\n      ")])]):e.disconnected?n("v-btn",{staticClass:"btn ma-1 mb-0 connectUserButton",class:e.skeleton?"skeleton-background skeleton-text":"btn-primary",attrs:{loading:e.sendingAction,disabled:e.sendingAction||e.skeleton},on:{click:e.connect}},[n("i",{staticClass:"uiIconSocConnectUser"}),e._v(" "),n("span",{staticClass:"buttonText"},[e._v("\n        "+e._s(e.$t("profileHeader.button.connect"))+"\n      ")])]):e._e(),e._v(" "),n("div",{staticClass:"profileHeaderActionComponents order-first mb-0",class:e.isMobile?"ma-0 mt-0 mr-n2":"ma-2"},e._l(e.enabledProfileHeaderActionComponents,(function(t){return n("div",{key:t.key,ref:t.key,refInFor:!0,class:t.appClass+" "+t.typeClass},[t.component?n("div",[n(t.component.name,e._b({directives:[{name:"dynamic-events",rawName:"v-dynamic-events",value:t.component.events,expression:"action.component.events"}],tag:"component"},"component",t.component.props?t.component.props:{},!1))],1):t.element?n("div",{domProps:{innerHTML:e._s(t.element.outerHTML)}}):t.html?n("div",{domProps:{innerHTML:e._s(t.html)}}):e._e(),e._v("\n        "+e._s(e.initTitleActionComponent(t))+"\n      ")])})),0)]:e._e()],2)};h._withStripped=!0;var m=Object(o.a)(v,h,[],!1,null,null,null);m.options.__file="src/main/webapp/vue-apps/profile-header/components/ProfileHeaderActions.vue";var g=m.exports,b={props:{user:{type:Object,default:function(){return null}},maxUploadSize:{type:Number,default:function(){return 0}},save:{type:Boolean,default:function(){return!1}},owner:{type:Boolean,default:function(){return!0}},hover:{type:Boolean,default:function(){return!1}},size:{type:Number,default:function(){return 165}},value:{type:String,default:function(){return null}}},data:function(){return{sendingImage:!1,avatarData:null}},watch:{sendingImage:function(){this.sendingImage?document.dispatchEvent(new CustomEvent("displayTopBarLoading")):document.dispatchEvent(new CustomEvent("hideTopBarLoading"))}},methods:{reset:function(){this.avatarData=null,this.sendingImage=!1},uploadAvatar:function(e){var t=this;if(e&&e.size){if(e.type&&0!==e.type.indexOf("image/"))return void this.$emit("error",this.$t("profile.warning.message.fileType"));if(e.size>this.maxUploadSize)return void this.$emit("error",this.$uploadService.avatarExcceedsLimitError);this.sendingImage=!0;var n=this;return this.$uploadService.upload(e).then((function(i){if(t.save)return t.$userService.updateProfileField(eXo.env.portal.userName,"avatar",i);var r=new FileReader;r.onload=function(e){n.avatarData=e.target.result,n.$forceUpdate()},r.readAsDataURL(e),t.$emit("input",i)})).then((function(){return t.$emit("refresh")})).catch((function(e){return t.$emit("error",e)})).finally((function(){t.sendingImage=!1}))}}}},x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-avatar",{staticClass:"align-start flex-grow-0 ms-3 my-3 profileHeaderAvatar",class:e.owner&&e.hover&&"profileHeaderAvatarHoverEdit",attrs:{size:e.size}},[n("v-img",{attrs:{"lazy-src":e.avatarData||e.user&&e.user.avatar||"",src:e.avatarData||e.user&&e.user.avatar||"",transition:"none",eager:""}}),e._v(" "),e.owner&&!e.sendingImage?n("v-file-input",{directives:[{name:"show",rawName:"v-show",value:e.hover,expression:"hover"}],ref:"avatarInput",staticClass:"changeAvatarButton",attrs:{"prepend-icon":"mdi-camera",accept:"image/*",clearable:""},on:{change:e.uploadAvatar}}):e._e()],1)};x._withStripped=!0;var _=Object(o.a)(b,x,[],!1,null,null,null);_.options.__file="src/main/webapp/vue-apps/profile-header/components/ProfileHeaderAvatar.vue";var y=_.exports,C={props:{maxUploadSize:{type:Number,default:function(){return 2}},hover:{type:Boolean,default:function(){return!1}}},data:function(){return{sendingImage:!1}},watch:{sendingImage:function(){this.sendingImage?document.dispatchEvent(new CustomEvent("displayTopBarLoading")):document.dispatchEvent(new CustomEvent("hideTopBarLoading"))}},methods:{uploadBanner:function(e){var t=this;if(e&&e.size)return e.type&&0!==e.type.indexOf("image/")?void this.$emit("error",this.$t("profile.warning.message.fileType")):e.size>this.maxUploadSize?void this.$emit("error",this.$uploadService.bannerExcceedsLimitError):(this.sendingImage=!0,this.$uploadService.upload(e).then((function(e){return t.$userService.updateProfileField(eXo.env.portal.userName,"banner",e)})).then((function(){return t.$emit("refresh")})).catch((function(e){return t.$emit("error",e)})).finally((function(){t.sendingImage=!1})))}}},w=function(){var e=this.$createElement,t=this._self._c||e;return this.sendingImage?this._e():t("v-file-input",{directives:[{name:"show",rawName:"v-show",value:this.hover,expression:"hover"}],ref:"bannerInput",staticClass:"changeBannerButton me-4",attrs:{"prepend-icon":"fa-file-image",accept:"image/*",clearable:""},on:{change:this.uploadBanner}})};w._withStripped=!0;var S=Object(o.a)(C,w,[],!1,null,null,null);S.options.__file="src/main/webapp/vue-apps/profile-header/components/ProfileHeaderBannerButton.vue";var E={"profile-header":s,"profile-header-avatar":y,"profile-header-banner-button":S.exports,"profile-header-actions":g,"profile-header-text":d};for(var A in E)Vue.component(A,E[A]);if(extensionRegistry){var T=extensionRegistry.loadComponents("ProfileHeader");T&&T.length>0&&T.forEach((function(e){Vue.component(e.componentName,e.componentOptions)}))}document.dispatchEvent(new CustomEvent("displayTopBarLoading"));var B=eXo&&eXo.env.portal.language||"en",k=eXo.env.portal.context+"/"+eXo.env.portal.rest+"/i18n/bundle/locale.portlet.social.ProfileHeader-"+B+".json",H="ProfileHeader",I=H+"_"+eXo.env.portal.profileOwnerIdentityId;function O(e){exoi18n.loadLanguageAsync(B,k).then((function(t){var n=document.createElement("div");n.id=H,Vue.createApp({mounted:function(){document.dispatchEvent(new CustomEvent("hideTopBarLoading"))},template:"<profile-header v-cacheable=\"{cacheId: '"+I+'\'}" id="'+H+'" max-upload-size="'+e+'" />',i18n:t,vuetify:Vue.prototype.vuetifyOptions},n,"Profile Header")}))}}})}));