define((function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}({0:function(e,t,r){"use strict";function n(e,t,r,n,i,s,o,a){var u=typeof(e=e||{}).default;"object"!==u&&"function"!==u||(e=e.default);var l,p="function"==typeof e?e.options:e;if(t&&(p.render=t,p.staticRenderFns=r,p._compiled=!0),n&&(p.functional=!0),s&&(p._scopeId=s),o?(l=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),i&&i.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(o)},p._ssrRegister=l):i&&(l=a?function(){i.call(this,this.$root.$options.shadowRoot)}:i),l)if(p.functional){p._injectStyles=l;var c=p.render;p.render=function(e,t){return l.call(t),c(e,t)}}else{var m=p.beforeCreate;p.beforeCreate=m?[].concat(m,l):[l]}return{exports:e,options:p}}r.d(t,"a",(function(){return n}))},14:function(e,t,r){"use strict";r.r(t),r.d(t,"init",(function(){return X}));var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-app",{staticClass:"white"},[e.error?r("v-card-text",{staticClass:"errorMessage"},[r("v-alert",{attrs:{type:"error"}},[e._v("\n      "+e._s(e.error)+"\n    ")])],1):e._e(),e._v(" "),r("v-card",{staticClass:"d-flex flex py-4 ma-4",attrs:{flat:""}},[r("v-flex",{staticClass:"sm12 md4",attrs:{flat:""}},[r("groups-management-tree-toolbar"),e._v(" "),r("groups-management-tree")],1),e._v(" "),r("v-divider",{attrs:{vertical:""}}),e._v(" "),r("v-flex",{staticClass:"sm12 md8",attrs:{flat:""}},[r("groups-management-membership-toolbar"),e._v(" "),r("groups-management-membership-list")],1)],1),e._v(" "),r("groups-management-form-drawer"),e._v(" "),r("groups-management-membership-form-drawer")],1)};n._withStripped=!0;var i=r(0),s=Object(i.a)({data:function(){return{error:null}},mounted:function(){var e=this;this.$root.$on("error",(function(t){return e.error=t}))}},n,[],!1,null,null,null);s.options.__file="src/main/webapp/vue-apps/idm-groups-management/components/GroupsManagement.vue";var o=s.exports,a={data:function(){return{startSearchAfterInMilliseconds:600,endTypingKeywordTimeout:50,startTypingKeywordTimeout:0,keyword:null,groups:[],searching:0,loading:0,pageSize:50,selectedIndex:-1}},watch:{selectedIndex:function(){(0!==this.selectedIndex&&!this.selectedIndex||this.selectedIndex<0)&&this.$root.$emit("selectGroup")},searching:function(){this.$root.$emit("searchingGroup",this.searching)},keyword:function(){if(this.selectedIndex=-1,!this.keyword)return this.retrieveGroupTree();this.startTypingKeywordTimeout=Date.now(),this.loading||(this.searching++,this.waitForEndTyping())}},created:function(){var e=this;this.$root.$on("refreshGroup",this.updateGroupTree),this.$root.$on("removeGroup",this.removeGroup),this.$root.$on("retrieveGroupChildren",this.retrieveGroupTree),this.$root.$on("searchGroup",(function(t){return e.keyword=t})),this.retrieveGroupTree().finally((function(){return e.$root.$applicationLoaded()}))},methods:{updateGroupItem:function(e,t){var r=this;this.loading=!0;try{t||(t=this.groups);var n=t.findIndex((function(t){return t.id===e.id}));if(n>-1)return t.splice(n,1,e),void this.$forceUpdate();for(var i in t){var s=t[i];if(e.parentId&&s.children&&s.children.length&&0===e.parentId.indexOf(s.id))return this.$forceUpdate(),this.updateGroupItem(e,s.children)}}finally{this.$nextTick().then((function(){return r.loading=!1}))}},updateGroupTree:function(e,t,r){var n=this;this.loading=!0;try{r||(r=this.groups);var i=t&&t.id||e.parentId;for(var s in e.id||(e.id=e.parentId?e.parentId+"/"+e.groupName:e.groupName),r){var o=r[s];if(e.id===o.id)return Object.assign(o,e),!0;if(i&&0===i.indexOf(o.id)){var a=!1;if(o.children&&o.children.length&&(a=this.updateGroupTree(e,t,o.children)),a)return;if(i===o.id)return void(o.childrenRetrieved&&(o.children&&o.children.length?(o.children.push(e),o.children=o.children.slice()):o.children=[e],this.updateGroupItem(o)))}}i||this.groups.push(e)}finally{this.$nextTick().then((function(){return n.loading=!1}))}},removeGroup:function(e,t,r){var n=this;this.loading=!0;try{r||(r=this.groups);var i=r.findIndex((function(t){return t.id===e.id}));if(i>-1)return r.splice(i,1),t&&(r.length||delete t.children,this.updateGroupItem(t)),void this.$forceUpdate();for(var s in r){var o=r[s];if(e.parentId&&o.children&&o.children.length&&0===e.parentId.indexOf(o.id))return this.removeGroup(e,o,o.children)}}finally{this.$nextTick().then((function(){return n.loading=!1}))}},searchGroup:function(e,t){t||(t=this.groups);var r=t.find((function(t){return t.id===e}));if(r)return r;for(var n in t){var i=t[n];if(i.children&&i.children.length&&0===e.indexOf(i.id)){var s=this.searchGroup(e,i.children);if(s)return s}}},retrieveGroupTree:function(e,t){var r=this,n=e&&e.id||"";return e&&(e.loading=!0),this.loading++,fetch(eXo.env.portal.context+"/"+eXo.env.portal.rest+"/v1/groups/tree?parentId="+n+"&q="+(this.keyword||"")+"&&offset="+(t||0)+"&limit="+this.pageSize+"&returnSize=true",{method:"GET",credentials:"include"}).then((function(e){if(e&&e.ok)return e.json();throw new Error(r.$t("IDMManagement.error.UnknownServerError"))})).then((function(t){var n=t&&t.entities||[];return e?(e.childrenSize=t&&t.size||[],n.length&&(e.children=n)):r.groups=n,r.$nextTick()})).finally((function(){e&&(e.childrenRetrieved=!0,e.loading=!1),r.loading--}))},searchGroups:function(){var e=this;return this.loading++,fetch(eXo.env.portal.context+"/"+eXo.env.portal.rest+"/v1/groups?q="+(this.keyword||"")+"&offset=0&limit="+this.pageSize+"&tree=true&returnSize=true",{method:"GET",credentials:"include"}).then((function(t){if(t&&t.ok)return t.json();throw new Error(e.$t("IDMManagement.error.UnknownServerError"))})).then((function(t){e.groups=t&&t.entities||[]})).finally((function(){e.loading--,e.searching--}))},waitForEndTyping:function(){var e=this;window.setTimeout((function(){Date.now()-e.startTypingKeywordTimeout>e.startSearchAfterInMilliseconds?e.searchGroups():e.waitForEndTyping()}),this.endTypingKeywordTimeout)}}},u=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-list-item-group",{attrs:{color:"primary"},model:{value:e.selectedIndex,callback:function(t){e.selectedIndex=t},expression:"selectedIndex"}},e._l(e.groups,(function(t){return r("groups-management-tree-item",{key:t.id,staticClass:"ms-3",attrs:{group:t,"page-size":e.pageSize,loading:e.loading,"open-all":!!e.keyword}})})),1)};u._withStripped=!0;var l=Object(i.a)(a,u,[],!1,null,null,null);l.options.__file="src/main/webapp/vue-apps/idm-groups-management/components/GroupsManagementTree.vue";var p=l.exports,c={props:{group:{type:Object,default:null},selectedGroups:{type:Array,default:null},pageSize:{type:Number,default:10},loading:{type:Boolean,default:!1},openAll:{type:Boolean,default:!1}},data:function(){return{selected:!1,open:!1,page:1}},computed:{selectedClass:function(){return this.loading>=0&&this.selected?"mdi-menu-right":"mdi-menu-down"},pagesCount:function(){return parseInt((this.childrenSize+this.pageSize-1)/this.pageSize)},icon:function(){return this.loading>=0&&this.open?"mdi-menu-down":"mdi-menu-right"},loadingChildren:function(){return this.loading&&this.group.loading},displayChildren:function(){return this.loading>=0&&this.group.children&&this.group.children.length&&(this.open||this.openAll)},childrenSize:function(){return this.loading>=0&&this.group.childrenSize},children:function(){return this.loading>=0&&this.group.children},displayIcon:function(){return this.loading>=0&&!this.openAll&&(!this.group.childrenRetrieved||this.group.children)}},watch:{open:function(){if(this.open&&!this.group.childrenRetrieved){var e=(this.page-1)*this.pageSize;this.$root.$emit("retrieveGroupChildren",this.group,e)}},page:function(){var e=(this.page-1)*this.pageSize;this.$root.$emit("retrieveGroupChildren",this.group,e)}},created:function(){var e=this;this.$root.$on("selectGroup",(function(t){e.selected=t&&e.group.id===t.id}))},methods:{toogleOpenTree:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.open=!this.open}}},m=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("v-list-item",{class:e.selectedClass,attrs:{selectable:"",dense:""},on:{click:function(t){return e.$root.$emit("selectGroup",e.group)}}},[r("v-list-item-action",{staticClass:"me-4"},[e.displayIcon?r("v-btn",{attrs:{icon:""},on:{click:e.toogleOpenTree}},[e.loadingChildren?r("v-progress-circular",{attrs:{indeterminate:"",size:"32"}}):r("v-icon",{attrs:{size:"32"}},[e._v(e._s(e.icon))])],1):r("div",{staticClass:"ms-5 me-4"})],1),e._v(" "),r("v-list-item-content",[r("v-list-item-title",{staticClass:"font-weight-bold text-truncate",attrs:{title:e.group.label}},[e._v("\n        "+e._s(e.group.label)+"\n      ")]),e._v(" "),r("v-list-item-subtitle",{staticClass:"caption text-truncate",attrs:{title:e.group.id}},[e._v("\n        "+e._s(e.group.id)+"\n      ")])],1),e._v(" "),r("v-list-item-action",[r("groups-management-tree-group-menu",{attrs:{group:e.group}})],1)],1),e._v(" "),e.displayChildren?r("div",[r("div",{staticClass:"ms-3 d-flex flex-nowrap"},[e.pagesCount>1?r("v-pagination",{attrs:{length:e.pagesCount,"total-visible":5},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}}):e._e()],1),e._v(" "),e._l(e.children,(function(t){return r("groups-management-tree-item",{key:t.id,staticClass:"ms-3",attrs:{group:t,"page-size":e.pageSize,loading:e.loading,"open-all":e.openAll}})}))],2):e._e()],1)};m._withStripped=!0;var d=Object(i.a)(c,m,[],!1,null,null,null);d.options.__file="src/main/webapp/vue-apps/idm-groups-management/components/GroupsManagementTreeItem.vue";var h=d.exports,g={props:{group:{type:Object,default:null}},data:function(){return{displayActionMenu:!1}},computed:{deleteConfirmMessage:function(){return this.$t("GroupsManagement.message.confirmDelete",{0:this.group.label})},groupMenuParentId:function(){return"SpaceApplications"+parseInt(1e4*Math.random()).toString().toString()}},created:function(){var e=this;$(document).on("mousedown",(function(){e.displayActionMenu&&window.setTimeout((function(){e.displayActionMenu=!1,e.displaySecondButton=!1}),e.waitTimeUntilCloseMenu)}))},methods:{openMenu:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.displayActionMenu=!0},emitEvent:function(e,t){e&&(e.preventDefault(),e.stopPropagation()),this.$root.$emit(t,this.group)},deleteGroup:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.$refs.deleteConfirmDialog.open()},deleteConfirm:function(){var e=this;return this.loading=!0,fetch(eXo.env.portal.context+"/"+eXo.env.portal.rest+"/v1/groups?groupId="+this.group.id,{method:"DELETE",credentials:"include"}).then((function(t){if(!t||!t.ok){if(t&&400===t.status)return t.text().then((function(e){throw new Error(e)}));throw new Error(e.$t("IDMManagement.error.UnknownServerError"))}return e.$root.$emit("removeGroup",e.group)})).catch((function(t){var r="GroupsManagement.error."+(t=t.message||String(t)),n=e.$t(r,{0:e.group.label});n!==r&&(t=n),e.$root.$emit("error",t),window.setTimeout((function(){e.$root.$emit("error",null)}),5e3)})).finally((function(){return e.loading=!1}))}}},f=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:e.groupMenuParentId}},[r("exo-confirm-dialog",{ref:"deleteConfirmDialog",attrs:{message:e.deleteConfirmMessage,title:e.$t("GroupsManagement.title.confirmDelete"),"ok-label":e.$t("GroupsManagement.button.ok"),"cancel-label":e.$t("GroupsManagement.button.cancel")},on:{ok:function(t){return e.deleteConfirm()}}}),e._v(" "),r("v-btn",{staticClass:"groupMenuIcon",attrs:{icon:"",text:""},on:{click:e.openMenu}},[r("v-icon",{attrs:{size:"21"}},[e._v("mdi-dots-vertical")])],1),e._v(" "),r("v-menu",{ref:"actionMenu",attrs:{attach:"#"+e.groupMenuParentId,transition:"slide-x-reverse-transition","content-class":"groupActionMenu",right:"","offset-x":"","offset-y":""},model:{value:e.displayActionMenu,callback:function(t){e.displayActionMenu=t},expression:"displayActionMenu"}},[r("v-list",{staticClass:"pa-0",attrs:{dense:""}},[r("v-list-item",{on:{click:function(t){return e.emitEvent(t,"editGroup")}}},[r("v-list-item-title",{staticClass:"subtitle-2"},[r("i",{staticClass:"uiIcon uiIconEdit"}),e._v("\n          "+e._s(e.$t("GroupsManagement.edit"))+"\n        ")])],1),e._v(" "),r("v-list-item",{on:{click:function(t){return e.emitEvent(t,"addNewGroup")}}},[r("v-list-item-title",{staticClass:"subtitle-2"},[r("i",{staticClass:"uiIcon uiIconGroup"}),e._v("\n          "+e._s(e.$t("GroupsManagement.addSubGroup"))+"\n        ")])],1),e._v(" "),r("v-list-item",{on:{click:function(t){return e.emitEvent(t,"addNewMembership")}}},[r("v-list-item-title",{staticClass:"subtitle-2"},[r("i",{staticClass:"uiIcon uiIconSocConnectUser"}),e._v("\n          "+e._s(e.$t("GroupsManagement.addMember"))+"\n        ")])],1),e._v(" "),r("v-list-item",{on:{click:e.deleteGroup}},[r("v-list-item-title",{staticClass:"subtitle-2"},[r("i",{staticClass:"uiIcon uiIconTrash"}),e._v("\n          "+e._s(e.$t("GroupsManagement.delete"))+"\n        ")])],1)],1)],1)],1)};f._withStripped=!0;var v=Object(i.a)(g,f,[],!1,null,null,null);v.options.__file="src/main/webapp/vue-apps/idm-groups-management/components/GroupsManagementTreeGroupMenu.vue";var b=v.exports,w=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-flex",{staticClass:"d-flex flex-row",attrs:{id:"groupsManagementToolbar"}},[r("v-flex",{staticClass:"mx-3 d-flex flex-grow-0 groupsManagementToolbarButton"},[r("v-btn",{staticClass:"btn btn-primary my-auto addNewGroupButton",on:{click:function(t){return e.$root.$emit("addNewGroup")}}},[r("i",{staticClass:"uiIconGroup uiIconWhite me-md-3"}),e._v(" "),r("span",{staticClass:"d-none d-sm-inline"},[e._v("\n        "+e._s(e.$t("GroupsManagement.addGroup"))+"\n      ")])])],1),e._v(" "),r("v-flex",{staticClass:"mx-3 d-flex flex-column flex-grow-1 groupsManagementToolbarFilter"},[r("v-text-field",{staticClass:"inputMembershipTypeFilter pa-0 my-auto",attrs:{placeholder:e.$t("GroupsManagement.filterByGroup"),"prepend-inner-icon":"fa-filter"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),e.searching?r("v-progress-linear",{staticClass:"groupSearchingProgressBar",attrs:{color:"primary",indeterminate:"",size:"32"}}):e._e()],1)],1)};w._withStripped=!0;var y=Object(i.a)({data:function(){return{keyword:null,searching:!1}},watch:{keyword:function(){this.$root.$emit("searchGroup",this.keyword)}},created:function(){var e=this;this.$root.$on("searchingGroup",(function(t){return e.searching=t}))}},w,[],!1,null,null,null);y.options.__file="src/main/webapp/vue-apps/idm-groups-management/components/GroupsManagementTreeToolbar.vue";var M=y.exports,_=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-toolbar",{attrs:{id:"groupsManagementToolbar",flat:""}},[r("v-toolbar-title",[r("v-btn",{staticClass:"btn addNewMembershipButton",attrs:{disabled:!e.group},on:{click:function(t){return e.$root.$emit("addNewMembership",e.group)}}},[r("i",{staticClass:"uiIconSocConnectUser me-md-3"}),e._v(" "),r("span",{staticClass:"d-none d-sm-inline"},[e._v("\n        "+e._s(e.$t("GroupsManagement.addMemberInGroup"))+"\n      ")])])],1),e._v(" "),r("v-spacer"),e._v(" "),r("v-scale-transition",[r("v-text-field",{staticClass:"inputMembershipTypeFilter pa-0 me-3 my-auto",attrs:{placeholder:e.$t("GroupsManagement.filterBy"),disabled:!e.group,"prepend-inner-icon":"fa-filter"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1)],1)};_._withStripped=!0;var x=Object(i.a)({data:function(){return{group:null,keyword:null}},watch:{keyword:function(){this.$root.$emit("searchGroupMemberships",this.keyword)}},created:function(){var e=this;this.$root.$on("selectGroup",(function(t){return e.group=t}))}},_,[],!1,null,null,null);x.options.__file="src/main/webapp/vue-apps/idm-groups-management/components/GroupsManagementMembershipToolbar.vue";var C=x.exports,G={data:function(){return{error:null,fieldError:!1,drawer:!1,newGroup:!1,saving:!1,confirmNewPassword:null,group:{},parentGroup:null}},computed:{title:function(){return this.newGroup?this.$t("GroupsManagement.addGroup"):this.$t("GroupsManagement.editGroup")}},watch:{confirmNewPassword:function(){this.resetCustomValidity()},saving:function(){this.saving?this.$refs.groupFormDrawer.startLoading():this.$refs.groupFormDrawer.endLoading()},drawer:function(){var e=this;this.drawer?(this.$refs.groupFormDrawer.open(),window.setTimeout((function(){e.newGroup?e.$refs.nameInput.focus():e.$refs.labelInput.focus()}),200)):this.$refs.groupFormDrawer.close()}},created:function(){this.$root.$on("addNewGroup",this.addNewGroup),this.$root.$on("editGroup",this.editGroup)},methods:{resetCustomValidity:function(){this.$refs.nameInput.setCustomValidity("")},addNewGroup:function(e){this.parentGroup=e,this.group={parentId:this.parentGroup&&this.parentGroup.id||null},this.newGroup=!0,this.drawer=!0},editGroup:function(e){this.group={id:e.id,parentId:e.parentId,groupName:e.groupName,label:e.label,description:e.description},this.newGroup=!1,this.drawer=!0},saveGroup:function(e){var t=this,r=/(?!^\d)^[a-zA-Z0-9-_]+$/.test(this.group.groupName);if(this.group.groupName&&(r?this.group.groupName.length<3||this.group.groupName.length>30?this.$refs.nameInput.setCustomValidity(this.$t("GroupsManagement.message.invalidFieldLength",{0:this.$t("GroupsManagement.name"),1:3,2:50})):this.$refs.nameInput.setCustomValidity(""):this.$refs.nameInput.setCustomValidity(this.$t("GroupsManagement.error.invalidField",{0:this.$t("GroupsManagement.name")}))),this.group.label&&(this.group.label.length<3||this.group.label.length>50?this.$refs.labelInput.setCustomValidity(this.$t("GroupsManagement.message.invalidFieldLength",{0:this.$t("GroupsManagement.label"),1:3,2:50})):this.$refs.labelInput.setCustomValidity("")),this.group.description&&(this.group.description.length<3||this.group.description.length>255?this.$refs.descriptionInput.setCustomValidity(this.$t("GroupsManagement.message.invalidFieldLength",{0:this.$t("GroupsManagement.description"),1:0,2:255})):this.$refs.descriptionInput.setCustomValidity("")),e&&(e.preventDefault(),e.stopPropagation()),this.error=null,this.fieldError=!1,this.$refs.groupForm.validate()&&this.$refs.groupForm.$el.reportValidity())return this.saving=!0,fetch(eXo.env.portal.context+"/"+eXo.env.portal.rest+"/v1/groups",{method:this.newGroup?"POST":"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.group)}).then((function(e){if(!e||!e.ok){if(400===e.status)return e.text().then((function(e){throw t.fieldError=e,new Error(e)}));throw new Error(t.$t("IDMManagement.error.UnknownServerError"))}})).then((function(){return t.$root.$emit("refreshGroup",t.group,t.parentGroup)})).then((function(){return t.$refs.groupFormDrawer.close()})).catch(this.handleError).finally((function(){return t.saving=!1}))},cancel:function(){this.drawer=!1},handleError:function(e){var t=this;this.resetCustomValidity(),e?(this.fieldError&&"NAME:ALREADY_EXISTS"===this.fieldError?this.$refs.nameInput.setCustomValidity(this.$t("GroupsManagement.message.sameNameAlreadyExists")):(this.error=String(e),window.setTimeout((function(){t.error=null}),5e3)),window.setTimeout((function(){t.$refs.groupForm.validate()&&t.$refs.groupForm.$el.reportValidity()}),200)):this.error=null}}},T=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("exo-drawer",{ref:"groupFormDrawer",attrs:{id:"groupFormDrawer",right:""},on:{closed:function(t){e.drawer=!1}}},[r("template",{slot:"title"},[e._v("\n    "+e._s(e.title)+"\n  ")]),e._v(" "),r("template",{slot:"content"},[r("v-form",{ref:"groupForm",staticClass:"form-horizontal pt-0 pb-4",attrs:{flat:""},on:{submit:e.saveGroup}},[e.error?r("v-card-text",{staticClass:"errorMessage"},[r("v-alert",{attrs:{type:"error"}},[e._v("\n          "+e._s(e.error)+"\n        ")])],1):e._e(),e._v(" "),r("v-card-text",{staticClass:"d-flex groupNameLabel flex-grow-1 text-no-wrap text-left font-weight-bold pb-2"},[e._v("\n        "+e._s(e.$t("GroupsManagement.name"))),e.newGroup?[e._v("*")]:e._e()],2),e._v(" "),r("v-card-text",{staticClass:"d-flex groupNameField py-0"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.group.groupName,expression:"group.groupName"}],ref:"nameInput",staticClass:"ignore-vuetify-classes flex-grow-1",attrs:{disabled:e.saving||!e.newGroup,autofocus:e.drawer,placeholder:e.$t("GroupsManagement.namePlaceholder"),type:"text",maxlength:"2000",required:""},domProps:{value:e.group.groupName},on:{input:function(t){t.target.composing||e.$set(e.group,"groupName",t.target.value)}}})]),e._v(" "),r("v-card-text",{staticClass:"d-flex groupNameLabel flex-grow-1 text-no-wrap text-left font-weight-bold pb-2"},[e._v("\n        "+e._s(e.$t("GroupsManagement.label"))+"*\n      ")]),e._v(" "),r("v-card-text",{staticClass:"d-flex groupNameField py-0"},[r("input",{directives:[{name:"model",rawName:"v-model",value:e.group.label,expression:"group.label"}],ref:"labelInput",staticClass:"ignore-vuetify-classes flex-grow-1",attrs:{disabled:e.saving,placeholder:e.$t("GroupsManagement.labelPlaceholder"),type:"text",maxlength:"2000",required:""},domProps:{value:e.group.label},on:{input:function(t){t.target.composing||e.$set(e.group,"label",t.target.value)}}})]),e._v(" "),r("v-card-text",{staticClass:"d-flex descriptionLabel flex-grow-1 text-no-wrap text-left font-weight-bold pb-2"},[e._v("\n        "+e._s(e.$t("GroupsManagement.description"))+"\n      ")]),e._v(" "),r("v-card-text",{staticClass:"d-flex descriptionField py-0"},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.group.description,expression:"group.description"}],ref:"descriptionInput",staticClass:"ignore-vuetify-classes flex-grow-1 textarea-no-resize",attrs:{disabled:e.saving,placeholder:e.$t("GroupsManagement.descriptionPlaceholder"),type:"text",maxlength:"2000"},domProps:{value:e.group.description},on:{input:function(t){t.target.composing||e.$set(e.group,"description",t.target.value)}}})])],1)],1),e._v(" "),r("template",{slot:"footer"},[r("div",{staticClass:"d-flex"},[r("v-spacer"),e._v(" "),r("v-btn",{staticClass:"btn me-2",attrs:{disabled:e.saving},on:{click:e.cancel}},[e._v("\n        "+e._s(e.$t("GroupsManagement.button.cancel"))+"\n      ")]),e._v(" "),r("v-btn",{staticClass:"btn btn-primary",attrs:{disabled:e.saving,loading:e.saving},on:{click:e.saveGroup}},[e._v("\n        "+e._s(e.$t("GroupsManagement.button.save"))+"\n      ")])],1)])],2)};T._withStripped=!0;var S=Object(i.a)(G,T,[],!1,null,null,null);S.options.__file="src/main/webapp/vue-apps/idm-groups-management/components/GroupsManagementFormDrawer.vue";var I=S.exports,k={data:function(){return{startSearchAfterInMilliseconds:600,endTypingKeywordTimeout:50,startTypingKeywordTimeout:0,itemsPerPageOptions:[20,50,100],memberships:[],selectedMembership:null,deleteConfirmMessage:null,keyword:null,dateTimeFormat:{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"},group:null,totalSize:0,options:{page:1,itemsPerPage:20},loading:!1}},computed:{hasPages:function(){return this.totalSize>this.options.itemsPerPage},filteredMemberships:function(){var e=this;return this.keyword?this.memberships.slice().filter((function(t){return t&&t.fullName&&t.fullName.toLowerCase().indexOf(e.keyword.toLowerCase())>=0||t.email&&t.email.toLowerCase().indexOf(e.keyword.toLowerCase())>=0})):this.memberships.slice()},headers:function(){return[{text:this.$t&&this.$t("UsersManagement.userName"),value:"userName",align:"center",class:"text-no-wrap",sortable:!1},{text:this.$t&&this.$t("UsersManagement.lastName"),value:"lastName",align:"center",class:"text-no-wrap",sortable:!1},{text:this.$t&&this.$t("UsersManagement.firstName"),value:"firstName",align:"center",class:"text-no-wrap",sortable:!1},{text:this.$t&&this.$t("UsersManagement.email"),value:"email",align:"center",class:"text-no-wrap",sortable:!1},{text:this.$t&&this.$t("UsersManagement.membershipType"),value:"membershipType",align:"center",class:"text-no-wrap",sortable:!1},{text:this.$t&&this.$t("UsersManagement.actions"),value:"actions",align:"center",class:"text-no-wrap",sortable:!1}]}},watch:{options:function(){this.searchMemberships()},keyword:function(){if(this.options.page=1,!this.keyword)return this.searchMemberships();this.startTypingKeywordTimeout=Date.now(),this.loading||(this.loading=!0,this.waitForEndTyping())},group:function(){return this.options.page=1,this.searchMemberships()}},created:function(){var e=this;this.$root.$on("searchGroupMemberships",this.updateSearchTerms),this.$root.$on("selectGroup",(function(t){return e.group=t})),this.$root.$on("refreshGroupMemberships",(function(){return e.searchMemberships()}))},methods:{updateSearchTerms:function(e){this.keyword=e},deleteMembership:function(e){this.selectedMembership=e,this.deleteConfirmMessage=this.$t("GroupsManagement.message.confirmDeleteMembership",{0:this.selectedMembership.fullName,1:this.selectedMembership.membershipType}),this.$refs.deleteConfirmDialog.open()},deleteConfirm:function(){var e=this;return this.loading=!0,fetch(eXo.env.portal.context+"/"+eXo.env.portal.rest+"/v1/groups/memberships?membershipId="+this.selectedMembership.id,{method:"DELETE",credentials:"include"}).then((function(t){if(!t||!t.ok)throw new Error(e.$t("IDMManagement.error.UnknownServerError"));return e.searchMemberships()})).finally((function(){return e.loading=!1}))},searchMemberships:function(e){var t=this;if(!this.group)return this.memberships=[],void(this.totalSize=0);var r=((this.options&&this.options.page)-1)*(e=e||this.options.itemsPerPage);return this.loading=!0,fetch(eXo.env.portal.context+"/"+eXo.env.portal.rest+"/v1/groups/memberships?groupId="+this.group.id+"&offset="+r+"&limit="+e+"&returnSize=true",{method:"GET",credentials:"include"}).then((function(e){if(e&&e.ok)return e.json();throw new Error(t.$t("IDMManagement.error.UnknownServerError"))})).then((function(r){if(t.memberships=r&&r.entities||[],t.totalSize=r&&r.size||0,t.keyword)return t.$nextTick().then((function(){var r=t.totalSize;if(t.totalSize=t.filteredMemberships.length,e<r&&t.filteredMemberships.length<t.options.itemsPerPage){var n=Math.min(2*e,r);return t.searchMemberships(n)}}))})).finally((function(){return t.loading=!1}))},waitForEndTyping:function(){var e=this;window.setTimeout((function(){Date.now()-e.startTypingKeywordTimeout>e.startSearchAfterInMilliseconds?e.searchMemberships():e.waitForEndTyping()}),this.endTypingKeywordTimeout)}}},E=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"ms-4 me-7"},[r("exo-confirm-dialog",{ref:"deleteConfirmDialog",attrs:{message:e.deleteConfirmMessage,title:e.$t("GroupsManagement.title.confirmDeleteMembership"),"ok-label":e.$t("GroupsManagement.button.ok"),"cancel-label":e.$t("GroupsManagement.button.cancel")},on:{ok:function(t){return e.deleteConfirm()}}}),e._v(" "),r("v-data-table",{staticClass:"data-table-light-border",attrs:{headers:e.headers,items:e.filteredMemberships,loading:e.loading,options:e.options,"footer-props":{itemsPerPageOptions:e.itemsPerPageOptions},"hide-default-footer":!e.hasPages,"server-items-length":e.totalSize,"loading-text":e.$t("UsersManagement.loadingResults"),"no-results-text":e.$t("UsersManagement.noResultsFound"),"no-data-text":e.$t("UsersManagement.noData")},on:{"update:options":function(t){e.options=t}},scopedSlots:e._u([{key:"item.actions",fn:function(t){var n=t.item;return[r("div",{staticClass:"d-flex flex-no-wrap"},[r("v-btn",{attrs:{title:e.$t("GroupsManagement.editMembership"),primary:"",icon:"",text:""},on:{click:function(t){return e.$root.$emit("editMembership",n,e.group)}}},[r("i",{staticClass:"uiIconEdit"})]),e._v(" "),r("v-btn",{attrs:{title:e.$t("GroupsManagement.button.delete"),primary:"",icon:"",text:""},on:{click:function(t){return e.deleteMembership(n)}}},[r("i",{staticClass:"uiIconTrash"})])],1)]}}])})],1)};E._withStripped=!0;var N=Object(i.a)(k,E,[],!1,null,null,null);N.options.__file="src/main/webapp/vue-apps/idm-groups-management/components/GroupsManagementMembershipList.vue";var P=N.exports,D={data:function(){return{error:null,fieldError:!1,drawer:!1,newMembership:!1,saving:!1,confirmNewPassword:null,previousSearchTerm:null,searchTerm:null,loadingSuggestions:0,membershipTypes:[],users:[],memberships:[],selectedUsers:[],group:{},membership:{},membershipType:null}},computed:{title:function(){return this.newMembership?this.$t("GroupsManagement.addMemberInGroup"):this.$t("GroupsManagement.editMembership")}},watch:{searchTerm:function(e){var t=this;e&&e.length?window.setTimeout((function(){t.previousSearchTerm===t.searchTerm&&(t.users=[],t.loadingSuggestions++,t.$userService.getUsersByStatus(e,0,20,"ENABLED").then((function(e){t.users=e&&e.entities||[]})).finally((function(){return t.loadingSuggestions--}))),t.previousSearchTerm=t.searchTerm}),400):this.users=[]},saving:function(){this.saving?this.$refs.membershipFormDrawer.startLoading():this.$refs.membershipFormDrawer.endLoading()},drawer:function(){var e=this;this.drawer?(this.$refs.membershipFormDrawer.open(),window.setTimeout((function(){e.$refs.membershipTypeInput.focus(),$("#membershipFormDrawer #userNameInput").on("blur",(function(){e.$refs.userNameInput.isFocused=!1}))}),200)):this.$refs.membershipFormDrawer.close()},selectedUsers:function(){var e=this;this.selectedUsers.forEach((function(t){e.memberships.some((function(e){return e.userName===t}))||e.memberships.push({groupId:e.group.id,membershipType:e.membershipType,userName:t})}))}},created:function(){var e=this;return this.$root.$on("addNewMembership",this.addNewMembership),this.$root.$on("editMembership",this.editMembership),fetch(eXo.env.portal.context+"/"+eXo.env.portal.rest+"/v1/membershipTypes",{method:"GET",credentials:"include"}).then((function(t){if(t&&t.ok)return t.json();throw new Error(e.$t("IDMManagement.error.UnknownServerError"))})).then((function(t){e.membershipTypes=t||[]}))},methods:{resetCustomValidity:function(){this.$refs.membershipTypeInput.setCustomValidity("")},addNewMembership:function(e){this.membershipType="member",this.selectedUsers=[],this.membership={},this.group=e,this.newMembership=!0,this.drawer=!0},editMembership:function(e,t){this.membershipType=null,this.selectedUsers=[],this.membership=Object.assign({},e),this.group=t,this.newMembership=!1,this.refreshUserSelection(this.membership.userName),this.drawer=!0},saveMembership:function(e){var t=this;if(e&&(e.preventDefault(),e.stopPropagation()),this.error=null,this.fieldError=!1,this.resetCustomValidity(),this.$refs.membershipForm.validate()&&this.$refs.membershipForm.$el.reportValidity()){this.saving=!0,this.membership.groupId=this.group.id,this.memberships.forEach((function(e){return e.membershipType=t.membershipType}));var r=eXo.env.portal.context+"/"+eXo.env.portal.rest+"/v1/groups/"+(this.newMembership?"memberships/bulk":"memberships")+"?membershipId="+(this.membership.id||""),n={method:this.newMembership?"POST":"PUT",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.newMembership?this.memberships:this.membership)};return fetch(r,n).then((function(e){if(!e||!e.ok){if(400===e.status)return e.text().then((function(e){throw t.fieldError=e,new Error(e)}));throw new Error(t.$t("IDMManagement.error.UnknownServerError"))}})).then((function(){return t.$root.$emit("refreshGroupMemberships")})).then((function(){return t.$refs.membershipFormDrawer.close()})).catch(this.handleError).finally((function(){t.memberships=[],t.saving=!1}))}},cancel:function(){this.drawer=!1},handleError:function(e){var t=this;this.resetCustomValidity(),e?(this.fieldError&&"MEMBERSHIP:ALREADY_EXISTS"===this.fieldError?this.$refs.membershipTypeInput.setCustomValidity(this.$t("GroupsManagement.message.sameMembershipAlreadyExists")):(this.error=String(e),window.setTimeout((function(){t.error=null}),5e3)),window.setTimeout((function(){t.$refs.membershipForm.validate()&&t.$refs.membershipForm.$el.reportValidity()}),200)):this.error=null},refreshUserSelection:function(e){var t=this;e&&(this.loadingSuggestions++,this.$userService.getUsersByStatus(e,0,20,"ANY").then((function(e){return t.users=e&&e.entities||[]})).finally((function(){return t.loadingSuggestions--})))},removeMemberShip:function(e){this.memberships.splice(this.memberships.findIndex((function(t){return t.userName===e.userName})),1),this.selectedUsers.splice(this.selectedUsers.findIndex((function(t){return t===e.userName})),1)},clearSearch:function(){this.searchTerm=null}}},F=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("exo-drawer",{ref:"membershipFormDrawer",attrs:{id:"membershipFormDrawer",right:""},on:{closed:function(t){e.drawer=!1}}},[r("template",{slot:"title"},[e._v("\n    "+e._s(e.title)+"\n  ")]),e._v(" "),r("template",{slot:"content"},[r("v-form",{ref:"membershipForm",staticClass:"form-horizontal pt-0 pb-4",attrs:{flat:""},on:{submit:e.saveMembership}},[e.error?r("v-card-text",{staticClass:"errorMessage"},[r("v-alert",{attrs:{type:"error"}},[e._v("\n          "+e._s(e.error)+"\n        ")])],1):e._e(),e._v(" "),r("v-card-text",{staticClass:"d-flex membershipNameLabel flex-grow-1 text-no-wrap text-left font-weight-bold pb-2"},[e._v("\n        "+e._s(e.$t("UsersManagement.membershipType"))+" *\n      ")]),e._v(" "),r("v-card-text",{staticClass:"d-flex membershipNameField py-0"},[e.newMembership?[r("select",{directives:[{name:"model",rawName:"v-model",value:e.membershipType,expression:"membershipType"}],ref:"membershipTypeInput",staticClass:"input-block-level ignore-vuetify-classes",attrs:{disabled:e.saving,required:""},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.membershipType=t.target.multiple?r:r[0]}}},e._l(e.membershipTypes,(function(t){return r("option",{key:t.name,domProps:{value:t.name}},[e._v("\n              "+e._s(t.name)+"\n            ")])})),0)]:[r("select",{directives:[{name:"model",rawName:"v-model",value:e.membership.membershipType,expression:"membership.membershipType"}],ref:"membershipTypeInput",staticClass:"input-block-level ignore-vuetify-classes",attrs:{disabled:e.saving,required:""},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.membership,"membershipType",t.target.multiple?r:r[0])}}},e._l(e.membershipTypes,(function(t){return r("option",{key:t.name,domProps:{value:t.name}},[e._v("\n              "+e._s(t.name)+"\n            ")])})),0)]],2),e._v(" "),r("v-card-text",{staticClass:"d-flex membershipUser flex-grow-1 text-no-wrap text-left font-weight-bold pb-2"},[e._v("\n        "+e._s(e.$t("GroupsManagement.user"))+" *\n      ")]),e._v(" "),r("v-card-text",{staticClass:"d-flex membershipUserField py-0"},[e.newMembership?[r("v-autocomplete",{ref:"userNameInput",staticClass:"identitySuggester",attrs:{id:"userNameInput",disabled:e.saving||!e.newMembership,loading:e.loadingSuggestions>0,items:e.users,"search-input":e.searchTerm,placeholder:e.$t("GroupsManagement.addMemberInGroup"),required:!e.selectedUsers.length,"return-object":!1,name:"membershipUser",height:"100","append-icon":"","menu-props":"closeOnClick, maxHeight = 100","content-class":"identitySuggesterContent",width:"100%","max-width":"100%","item-text":"fullName","item-value":"userName","persistent-hint":"","hide-selected":"",chips:"","cache-items":"",dense:"",flat:"",multiple:""},on:{"update:searchInput":function(t){e.searchTerm=t},"update:search-input":[function(t){e.searchTerm=t},function(t){e.searchTerm=t}],change:e.clearSearch},scopedSlots:e._u([{key:"selection",fn:function(t){var n=t.item,i=t.selected;return[r("v-chip",{staticClass:"identitySuggesterItem",attrs:{"input-value":i,close:e.newMembership},on:{"click:close":function(t){return e.removeMemberShip(n)}}},[r("span",{staticClass:"text-truncate"},[e._v("\n                  "+e._s(n.fullName)+"\n                ")])])]}},{key:"item",fn:function(t){var n=t.item;return[r("v-list-item-title",{staticClass:"text-truncate identitySuggestionMenuItemText",domProps:{textContent:e._s(n.fullName)}})]}}],null,!1,2839965527),model:{value:e.selectedUsers,callback:function(t){e.selectedUsers=t},expression:"selectedUsers"}},[r("template",{slot:"no-data"},[r("v-list-item",{staticClass:"pa-0"},[r("v-list-item-title",{staticClass:"px-2"},[e._v("\n                  "+e._s(e.$t("GroupsManagement.label.addMembers"))+"\n                ")])],1)],1)],2)]:[r("v-autocomplete",{ref:"userNameInput",staticClass:"identitySuggester",attrs:{id:"userNameInput",disabled:e.saving||!e.newMembership,loading:e.loadingSuggestions>0,items:e.users,"search-input":e.searchTerm,placeholder:e.$t("GroupsManagement.addMemberInGroup"),required:!e.membership.userName,"return-object":!1,name:"membershipUser",height:"100","append-icon":"","menu-props":"closeOnClick, maxHeight = 100","content-class":"identitySuggesterContent",width:"100%","max-width":"100%","item-text":"fullName","item-value":"userName","persistent-hint":"","hide-selected":"",chips:"","cache-items":"",dense:"",flat:"","single-line":""},on:{"update:searchInput":function(t){e.searchTerm=t},"update:search-input":[function(t){e.searchTerm=t},function(t){e.searchTerm=t}]},scopedSlots:e._u([{key:"selection",fn:function(t){var n=t.item,i=t.selected;return[r("v-chip",{staticClass:"identitySuggesterItem",attrs:{"input-value":i,close:e.newMembership},on:{"click:close":function(t){e.membership.userName=null}}},[r("span",{staticClass:"text-truncate"},[e._v("\n                  "+e._s(n.fullName)+"\n                ")])])]}},{key:"item",fn:function(t){var n=t.item;return[r("v-list-item-title",{staticClass:"text-truncate identitySuggestionMenuItemText",domProps:{textContent:e._s(n.fullName)}})]}}]),model:{value:e.membership.userName,callback:function(t){e.$set(e.membership,"userName",t)},expression:"membership.userName"}},[r("template",{slot:"no-data"},[r("v-list-item",{staticClass:"pa-0"},[r("v-list-item-title",{staticClass:"px-2"},[e._v("\n                  "+e._s(e.$t("GroupsManagement.label.addMembers"))+"\n                ")])],1)],1)],2)]],2)],1)],1),e._v(" "),r("template",{slot:"footer"},[r("div",{staticClass:"d-flex"},[r("v-spacer"),e._v(" "),r("v-btn",{staticClass:"btn me-2",attrs:{disabled:e.saving},on:{click:e.cancel}},[e._v("\n        "+e._s(e.$t("GroupsManagement.button.cancel"))+"\n      ")]),e._v(" "),r("v-btn",{staticClass:"btn btn-primary",attrs:{disabled:e.saving,loading:e.saving},on:{click:e.saveMembership}},[e._v("\n        "+e._s(e.$t("GroupsManagement.button.save"))+"\n      ")])],1)])],2)};F._withStripped=!0;var U=Object(i.a)(D,F,[],!1,null,null,null);U.options.__file="src/main/webapp/vue-apps/idm-groups-management/components/GroupsManagementMembershipFormDrawer.vue";var O={"groups-management":o,"groups-management-tree":p,"groups-management-tree-item":h,"groups-management-tree-group-menu":b,"groups-management-tree-toolbar":M,"groups-management-form-drawer":I,"groups-management-membership-toolbar":C,"groups-management-membership-list":P,"groups-management-membership-form-drawer":U.exports};for(var z in O)Vue.component(z,O[z]);if(extensionRegistry){var A=extensionRegistry.loadComponents("GroupsManagement");A&&A.length>0&&A.forEach((function(e){Vue.component(e.componentName,e.componentOptions)}))}var j="undefined"!=typeof eXo?eXo.env.portal.language:"en";document.dispatchEvent(new CustomEvent("displayTopBarLoading"));var V="GroupsManagement",L=eXo.env.portal.context+"/"+eXo.env.portal.rest+"/i18n/bundle/locale.portlet.Portlets-"+j+".json";function X(){exoi18n.loadLanguageAsync(j,L).then((function(e){Vue.createApp({mounted:function(){document.dispatchEvent(new CustomEvent("hideTopBarLoading"))},template:'<groups-management id="'+V+'" />',vuetify:Vue.prototype.vuetifyOptions,i18n:e},"#"+V,"Group Management")}))}}})}));